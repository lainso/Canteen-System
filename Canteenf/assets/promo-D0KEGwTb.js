import{_ as Ve}from"./logo_circle-CFpan6rn.js";import{r as f,u as ke,a as I,h as ye,i as Ce,w as o,f as u,o as xe,e,d as s,j as h,b as r,k as we,D as $e,E as Ue,l as Ge,m as De,n as Pe,G as Ie,s as Se,p as Ee,g as Fe}from"./index-B7bPidm7.js";import{f as Ne,g as qe,h as Re,b as ze,i as Te}from"./super-BSGRXTtd.js";import{_ as Be}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./request-D3NgrpZ1.js";const m=G=>(Ee("data-v-0f32ffaa"),G=G(),Fe(),G),Me=m(()=>r("img",{style:{width:"60px","margin-left":"2rem"},src:Ve,alt:"logo"},null,-1)),je=m(()=>r("div",{class:"flex-grow"},null,-1)),He=m(()=>r("br",null,null,-1)),Oe=m(()=>r("span",null,"首页",-1)),Ye=m(()=>r("span",null,"账户管理",-1)),Ae=m(()=>r("span",null,"商户管理",-1)),Je=m(()=>r("span",null,"订单管理",-1)),Ke=m(()=>r("span",null,"通知管理",-1)),Le=m(()=>r("span",null,"支付卡管理",-1)),Qe=m(()=>r("span",null,"促销管理",-1)),We=m(()=>r("span",null,"账 号 设 置",-1)),Xe={class:"form-wrapper"},Ze={class:"new-button-container"},eo={class:"search-area"},oo=m(()=>r("br",null,null,-1)),lo=m(()=>r("br",null,null,-1)),to={class:"pagination-container"},no=m(()=>r("span",null,"此操作不可逆！是否确认删除该促销？",-1)),ao={class:"dialog-footer"},ro=m(()=>r("br",null,null,-1)),uo={class:"dialog-footer"},so=m(()=>r("br",null,null,-1)),io={class:"dialog-footer"},mo={__name:"promo",setup(G){const J=f("1"),c=ke(),z=f([]),T=f(1),S=f(null),E=f(null),V=f(null),C=f(null),x=f(!1),w=f(!1),$=f(!1),F=f(0),K=a=>{a&&a.validate(l=>{if(l)qe(i.promo_name,i.promo_code,i.promo_multiple,i.promo_start,i.promo_end).then(function(n){confirm("新增促销活动成功，是否前往发布通知？")&&(location.href="#/super/noti"),M(),w.value=!1,k("",1),console.log(n)}).catch(function(n){console.log(n)});else return!1})},U=I({key:""}),i=I({promo_name:"",promo_code:"",promo_multiple:"",promo_start:"",promo_end:""}),d=I({promo_name:"",promo_code:"",promo_multiple:"",promo_start:"",promo_end:""}),B=I({promo_name:[{required:!0,message:"促销名称不能为空",trigger:"blur"}],promo_code:[{required:!0,message:"促销码不能为空",trigger:"blur"}],promo_multiple:[{required:!0,message:"促销倍率不能为空",trigger:"blur"},{validator:(a,l,n)=>{const p=Number(l);return isNaN(p)?n(new Error("促销倍率必须是一个数字")):p<1?n(new Error("促销倍率需要大于1，否则会反向优惠。")):n()},message:"促销倍率必须为一个大于1的数字",trigger:["blur"]}],promo_start:[{required:!0,message:"促销开始时间不能为空",trigger:"blur"}],promo_end:[{required:!0,message:"促销结束时间不能为空",trigger:"blur"}]}),M=()=>{V.value&&V.value.resetFields()},j=()=>{C.value&&C.value.resetFields()};function L(a){S.value=a,x.value=!0}function Q(a){E.value=a,Object.keys(d).forEach(l=>{d[l]=a[l]??""}),$.value=!0}const W=(a,l)=>{console.log(a,l),Te(a,l).then(function(n){alert("修改成功"),console.log(n),k("",1)}).catch(function(n){console.log(n)}),j()};function X(){!C.value||!E.value||C.value.validate(a=>{if(a){let l={promo_name:d.promo_name,promo_code:d.promo_code,promo_multiple:d.promo_multiple,promo_start:d.promo_start,promo_end:d.promo_end};const n=E.value.id;W(n,l),$.value=!1}else console.log("编辑表单验证失败")})}function Z(){S.value&&ee(S.value),x.value=!1}const ee=a=>{Re(a.id).then(function(l){alert(l),k("",1)}).catch(function(l){console.log(l)})},oe=a=>{k(a,1)},le=a=>{k(U.key,a)},k=(a,l)=>{Ne(a,11,l).then(function(n){z.value=n.data.map(p=>(p.promo_start=H(p.promo_start),p.promo_end=H(p.promo_end),p)),F.value=n.total,F.value=n.total}).catch(function(n){console.log(n)})},H=a=>{if(a===null||a==="")return"";{const l=new Date(a);l.setHours(l.getHours());const n=l.getFullYear(),p=(l.getMonth()+1).toString().padStart(2,"0"),N=l.getDate().toString().padStart(2,"0");return`${n}-${p}-${N}`}};ye(()=>{k("",1)});const O=()=>{c.push("/super/index")},te=()=>{c.push("/super/order")},ne=()=>{c.push("/super/noti")},ae=()=>{c.push("/super/paycard")},re=()=>{c.push("/super/me")},ue=()=>{c.push("/super/payment")},se=()=>{c.push("/super/dish")},de=()=>{c.push("/super/emp")},ie=()=>{c.push("/super/shop")},me=()=>{c.push("/super/promo")},pe=()=>{c.push("/super/customer")},Y=()=>{localStorage.removeItem("userInfo"),ze().then(function(a){console.log(a)}).catch(function(a){console.log(a)})};return(a,l)=>{const n=u("el-menu-item"),p=u("el-menu"),N=u("el-header"),v=u("el-icon"),q=u("el-sub-menu"),_e=u("el-col"),ce=u("el-row"),g=u("el-button"),_=u("el-form-item"),D=u("el-form"),b=u("el-input"),fe=u("el-card"),y=u("el-table-column"),ge=u("el-table"),ve=u("el-pagination"),R=u("el-dialog"),P=u("el-date-picker"),he=u("el-main"),A=u("el-container");return xe(),Ce(A,{style:{height:"100vh"}},{default:o(()=>[e(N,{class:"header-menu"},{default:o(()=>[e(p,{"default-active":J.value,class:"el-menu-demo",mode:"horizontal",ellipsis:!1},{default:o(()=>[Me,e(n,{onClick:O,index:"1",style:{"font-weight":"bold","margin-left":"3rem"}},{default:o(()=>[s(" 内 部 餐 饮 系 统 - 管 理 员 端 ")]),_:1}),je,e(n,{index:"2",onClick:Y},{default:o(()=>[s("退 出 登 录")]),_:1})]),_:1},8,["default-active"])]),_:1}),e(A,null,{default:o(()=>[e(ce,{class:"tac"},{default:o(()=>[e(_e,{span:24},{default:o(()=>[He,e(p,{"default-active":"7",class:"el-menu-vertical-demo"},{default:o(()=>[e(n,{index:"1",onClick:O},{default:o(()=>[e(v,null,{default:o(()=>[e(h(we))]),_:1}),Oe]),_:1}),e(n,{index:"2",onClick:pe},{default:o(()=>[e(v,null,{default:o(()=>[e(h($e))]),_:1}),Ye]),_:1}),e(q,{index:"3"},{title:o(()=>[e(v,null,{default:o(()=>[e(h(Ue))]),_:1}),Ae]),default:o(()=>[e(n,{index:"3-1",onClick:ie},{default:o(()=>[s("商户")]),_:1}),e(n,{index:"3-2",onClick:de},{default:o(()=>[s("雇员")]),_:1}),e(n,{index:"3-3",onClick:se},{default:o(()=>[s("菜品")]),_:1})]),_:1}),e(q,{index:"4"},{title:o(()=>[e(v,null,{default:o(()=>[e(h(Ge))]),_:1}),Je]),default:o(()=>[e(n,{index:"4-1",onClick:te},{default:o(()=>[s("订单")]),_:1}),e(n,{index:"4-2",onClick:ue},{default:o(()=>[s("支付记录")]),_:1})]),_:1}),e(n,{index:"5",onClick:ne},{default:o(()=>[e(v,null,{default:o(()=>[e(h(De))]),_:1}),Ke]),_:1}),e(n,{index:"6",onClick:ae},{default:o(()=>[e(v,null,{default:o(()=>[e(h(Pe))]),_:1}),Le]),_:1}),e(n,{index:"7",onClick:me},{default:o(()=>[e(v,null,{default:o(()=>[e(h(Ie))]),_:1}),Qe]),_:1}),e(q,{index:"8"},{title:o(()=>[e(v,null,{default:o(()=>[e(h(Se))]),_:1}),We]),default:o(()=>[e(n,{index:"8-1",onClick:re},{default:o(()=>[s("个 人 中 心")]),_:1}),e(n,{index:"8-2",onClick:Y},{default:o(()=>[s("退 出 账 号")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(he,{style:{"background-image":"none",display:"block",height:"auto"}},{default:o(()=>[e(fe,{class:"box-card",shadow:"hover"},{default:o(()=>[r("div",Xe,[r("div",Ze,[e(D,{inline:!0,"label-width":"20%"},{default:o(()=>[e(_,{class:"add-button-item"},{default:o(()=>[e(g,{type:"success",onClick:l[0]||(l[0]=t=>{w.value=!0})},{default:o(()=>[s("新增促销")]),_:1})]),_:1})]),_:1})]),r("div",eo,[e(D,{inline:!0,model:U,"label-width":"20%",class:"demo-form-inline search-form","status-icon":""},{default:o(()=>[e(_,{label:"优惠名称",prop:"key","label-width":"100px"},{default:o(()=>[e(b,{modelValue:U.key,"onUpdate:modelValue":l[1]||(l[1]=t=>U.key=t),style:{width:"350px"},clearable:""},null,8,["modelValue"])]),_:1}),e(_,null,{default:o(()=>[e(g,{onClick:l[2]||(l[2]=t=>oe(U.key)),type:"primary"},{default:o(()=>[s("搜索")]),_:1})]),_:1})]),_:1},8,["model"])])])]),_:1}),oo,e(ge,{data:z.value,style:{width:"100%"}},{default:o(()=>[e(y,{prop:"promo_name",label:"名称",width:"140"}),e(y,{prop:"promo_multiple",label:"优惠倍率",width:"150"}),e(y,{prop:"promo_code",label:"促销码"}),e(y,{prop:"promo_start",label:"开始时间"}),e(y,{prop:"promo_end",label:"结束时间"}),e(y,{label:"操作"},{default:o(t=>[e(g,{type:"primary",size:"small",onClick:be=>Q(t.row)},{default:o(()=>[s("编辑")]),_:2},1032,["onClick"]),e(g,{size:"small",type:"danger",onClick:be=>L(t.row)},{default:o(()=>[s("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),lo,r("div",to,[e(ve,{"current-page":T.value,"onUpdate:currentPage":l[3]||(l[3]=t=>T.value=t),"page-size":11,layout:"prev, pager, next",total:F.value,onCurrentChange:le},null,8,["current-page","total"])]),e(R,{style:{"margin-right":"56vh","margin-top":"40vh"},modelValue:x.value,"onUpdate:modelValue":l[5]||(l[5]=t=>x.value=t),title:"操作确认",width:"500"},{footer:o(()=>[r("div",ao,[e(g,{onClick:l[4]||(l[4]=t=>x.value=!1)},{default:o(()=>[s("取消")]),_:1}),e(g,{type:"danger",onClick:Z},{default:o(()=>[s(" 确认 ")]),_:1})])]),default:o(()=>[no]),_:1},8,["modelValue"]),e(R,{style:{"margin-right":"58vh","margin-top":"25vh"},modelValue:w.value,"onUpdate:modelValue":l[13]||(l[13]=t=>w.value=t),title:"新建促销",width:"500"},{footer:o(()=>[r("div",uo,[e(g,{onClick:l[11]||(l[11]=t=>{w.value=!1,M(V.value)})},{default:o(()=>[s("取消")]),_:1}),e(g,{type:"success",onClick:l[12]||(l[12]=t=>K(V.value))},{default:o(()=>[s(" 确认新增 ")]),_:1})])]),default:o(()=>[ro,e(D,{ref_key:"ruleFormRef",ref:V,model:i,rules:B,"label-width":"17%",class:"demo-form","status-icon":""},{default:o(()=>[e(_,{label:"促销名称",prop:"promo_name"},{default:o(()=>[e(b,{modelValue:i.promo_name,"onUpdate:modelValue":l[6]||(l[6]=t=>i.promo_name=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"促销码",prop:"promo_code"},{default:o(()=>[e(b,{modelValue:i.promo_code,"onUpdate:modelValue":l[7]||(l[7]=t=>i.promo_code=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"优惠倍率",prop:"promo_multiple"},{default:o(()=>[e(b,{modelValue:i.promo_multiple,"onUpdate:modelValue":l[8]||(l[8]=t=>i.promo_multiple=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"开始时间",prop:"promo_start"},{default:o(()=>[e(P,{modelValue:i.promo_start,"onUpdate:modelValue":l[9]||(l[9]=t=>i.promo_start=t),type:"date",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{label:"结束时间",prop:"promo_end"},{default:o(()=>[e(P,{modelValue:i.promo_end,"onUpdate:modelValue":l[10]||(l[10]=t=>i.promo_end=t),type:"date",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),e(R,{style:{"margin-right":"58vh","margin-top":"25vh"},modelValue:$.value,"onUpdate:modelValue":l[20]||(l[20]=t=>$.value=t),title:"促销信息修改",width:"500"},{footer:o(()=>[r("div",io,[e(g,{onClick:l[19]||(l[19]=t=>{$.value=!1,j(V.value)})},{default:o(()=>[s("取消")]),_:1}),e(g,{type:"primary",onClick:X},{default:o(()=>[s(" 确认修改 ")]),_:1})])]),default:o(()=>[so,e(D,{ref_key:"ruleFormRef3",ref:C,model:d,rules:B,"label-width":"17%",class:"demo-form","status-icon":""},{default:o(()=>[e(_,{label:"促销名称",prop:"promo_name"},{default:o(()=>[e(b,{modelValue:d.promo_name,"onUpdate:modelValue":l[14]||(l[14]=t=>d.promo_name=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"促销码",prop:"promo_code"},{default:o(()=>[e(b,{modelValue:d.promo_code,"onUpdate:modelValue":l[15]||(l[15]=t=>d.promo_code=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"优惠倍率",prop:"promo_multiple"},{default:o(()=>[e(b,{modelValue:d.promo_multiple,"onUpdate:modelValue":l[16]||(l[16]=t=>d.promo_multiple=t)},null,8,["modelValue"])]),_:1}),e(_,{label:"开始时间",prop:"promo_start"},{default:o(()=>[e(P,{modelValue:d.promo_start,"onUpdate:modelValue":l[17]||(l[17]=t=>d.promo_start=t),type:"date",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{label:"结束时间",prop:"promo_end"},{default:o(()=>[e(P,{modelValue:d.promo_end,"onUpdate:modelValue":l[18]||(l[18]=t=>d.promo_end=t),type:"date",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})}}},ho=Be(mo,[["__scopeId","data-v-0f32ffaa"]]);export{ho as default};
